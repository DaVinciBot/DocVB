---
title: Docker D√©butant
last_update:
  date: 2025-10-21
  author: Urbain Lantr√®s
tags: [info, sysadmin]
---
import DownloadButton from '@site/src/components/DownloadButton';
import DownloadGroup from '@site/src/components/DownloadGroup';

Dans ce tutoriel, nous allons cr√©er une application simple avec Node.js et la conteneuriser avec Docker. Nous allons √©galement apprendre √† construire et ex√©cuter notre conteneur Docker.

:::info Environnement de formation
Cette formation se d√©roule sur un VPS Linux sur lequel vous √™tes l'utilisateur root. **Note :** Utiliser root directement est une mauvaise pratique en production, mais acceptable pour l'apprentissage.
:::

## Pr√©requis

- Un serveur Linux (VPS ou machine virtuelle)
- Acc√®s SSH avec les droits root
- Connexion Internet

## √âtape 1 : Installation des outils n√©cessaires

Commen√ßons par installer Docker et quelques outils utiles pour la formation.

:::tip T√©l√©chargement des ressources
Vous pouvez t√©l√©charger l'application d'exemple directement :

<DownloadButton href="./files/app.zip" icon="üì¶">
  T√©l√©charger app.zip
</DownloadButton>
:::

### 1.1 T√©l√©charger le script d'installation de Docker

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
```

Cette commande t√©l√©charge le script officiel d'installation de Docker.

### 1.2 T√©l√©charger l'application d'exemple

```bash
wget https://davincibot.fr/ftp/app.zip
```

Ce fichier ZIP contient une application Node.js simple que nous allons conteneuriser.

### 1.3 Installer les outils suppl√©mentaires

```bash
apt install micro btop unzip -y
```

- **micro** : √©diteur de texte simple et intuitif
- **btop** : moniteur syst√®me interactif
- **unzip** : pour d√©compresser notre application

### 1.4 Installer Docker

```bash
sh get-docker.sh
```

Attendez que l'installation se termine. Vous pouvez v√©rifier l'installation avec :

```bash
docker --version
```

### 1.5 D√©compresser l'application

```bash
unzip app.zip
```

## √âtape 2 : Comprendre le Dockerfile

Cr√©ons un fichier `Dockerfile` √† la racine de notre projet. Ce fichier d√©crit comment construire notre image Docker.

### 2.1 Cr√©er le Dockerfile

Utilisez l'√©diteur `micro` pour cr√©er le fichier :

```bash
micro Dockerfile
```

### 2.2 Contenu du Dockerfile

Copiez le contenu suivant dans le fichier :

```dockerfile
# Use official Node.js runtime as base image
FROM node:18-alpine

# Set working directory in container
WORKDIR /usr/src/app

# Copy package files
COPY app/package*.json ./

# Install dependencies
RUN npm install

# Copy application code
COPY app/ .

# Expose port 80
EXPOSE 80

# Start the application
CMD ["node", "index.js"]
```

### 2.3 Explication du Dockerfile ligne par ligne

- **FROM node:18-alpine** : On utilise une image Node.js l√©g√®re bas√©e sur Alpine Linux
- **WORKDIR /usr/src/app** : D√©finit le r√©pertoire de travail dans le conteneur
- **COPY app/package*.json ./** : Copie les fichiers de d√©pendances npm
- **RUN npm install** : Installe les d√©pendances Node.js
- **COPY app/ .** : Copie tout le code de l'application
- **EXPOSE 80** : Indique que le conteneur √©coute sur le port 80
- **CMD ["node", "index.js"]** : Commande ex√©cut√©e au d√©marrage du conteneur

:::tip Bonne pratique
On copie d'abord `package.json` et on installe les d√©pendances avant de copier le reste du code. Cela permet √† Docker de mettre en cache cette √©tape et d'acc√©l√©rer les builds futurs.
:::

## √âtape 3 : Construire l'image Docker

Maintenant que notre Dockerfile est pr√™t, construisons notre image Docker.

### 3.1 Commande de build

```bash
docker build -t "dvb/sample" .
```

**Explication :**

- `docker build` : commande pour construire une image
- `-t "dvb/sample"` : donne un nom (tag) √† notre image
- `.` : indique que le Dockerfile est dans le r√©pertoire courant

### 3.2 V√©rifier l'image cr√©√©e

```bash
docker images
```

Vous devriez voir votre image `dvb/sample` dans la liste.

## √âtape 4 : Ex√©cuter le conteneur

### 4.1 Lancer le conteneur

```bash
docker run -p 80:80 "dvb/sample"
```

**Explication :**

- `docker run` : lance un nouveau conteneur
- `-p 80:80` : mappe le port 80 du conteneur vers le port 80 de l'h√¥te
- `"dvb/sample"` : nom de l'image √† utiliser

### 4.2 Tester l'application

Ouvrez un navigateur et acc√©dez √† l'adresse IP de votre serveur. L'application Node.js devrait √™tre accessible !

### 4.3 Arr√™ter le conteneur

Utilisez `Ctrl+C` pour arr√™ter le conteneur, ou dans un autre terminal :

```bash
docker ps  # Liste les conteneurs en cours
docker stop <container_id>  # Arr√™te un conteneur sp√©cifique
```

### 4.4 Ex√©cuter en arri√®re-plan

Pour lancer le conteneur en mode d√©tach√© (arri√®re-plan) :

```bash
docker run -d -p 80:80 --name mon-app "dvb/sample"
```

- `-d` : mode d√©tach√© (daemon)
- `--name mon-app` : donne un nom au conteneur

## √âtape 5 : Docker Compose (Avanc√©)

Pour des applications plus complexes avec plusieurs services, on utilise Docker Compose.

### 5.1 Cr√©er docker-compose.yml

```bash
micro docker-compose.yml
```

### 5.2 Configuration avec PostgreSQL

Voici un exemple de configuration avec une application Node.js et une base de donn√©es PostgreSQL :

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:80"
    environment:
      DB_HOST: postgres
      DB_PORT: 5432
      DB_NAME: myapp_db
      DB_USER: myapp_user
      DB_PASSWORD_FILE: /run/secrets/db_password
    secrets:
      - db_password
    depends_on:
      - postgres
    networks:
      - app-network

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: myapp_db
      POSTGRES_USER: myapp_user
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    secrets:
      - db_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app-network
    ports:
      - "5432:5432"

secrets:
  db_password:
    file: ./secrets/db_password.txt

volumes:
  postgres_data:

networks:
  app-network:
    driver: bridge
```

### 5.3 Explication de Docker Compose

Ce fichier d√©finit une application multi-conteneurs :

**Service `app` (notre application Node.js) :**

- **build: .** : construit l'image depuis le Dockerfile local
- **ports** : mappe le port 80 du conteneur vers le port 3000 de l'h√¥te
- **environment** : variables d'environnement pour la connexion √† la base de donn√©es
- **secrets** : gestion s√©curis√©e du mot de passe de la BD
- **depends_on** : d√©marre PostgreSQL avant l'application
- **networks** : connecte au r√©seau `app-network`

**Service `postgres` (base de donn√©es) :**

- **image: postgres:15-alpine** : utilise l'image officielle PostgreSQL
- **volumes** : persiste les donn√©es de la BD
- **secrets** : r√©cup√®re le mot de passe depuis un fichier s√©curis√©

### 5.4 Cr√©er le fichier de secrets

```bash
mkdir secrets
echo "mon_mot_de_passe_securise" > secrets/db_password.txt
```

:::warning S√©curit√©
En production, ne stockez jamais les secrets dans Git ! Ajoutez `secrets/` √† votre `.gitignore`.
:::

### 5.5 Lancer avec Docker Compose

```bash
docker-compose up -d
```

Cette commande :

- Construit les images si n√©cessaire
- Cr√©e les r√©seaux et volumes
- D√©marre tous les services en arri√®re-plan

### 5.6 V√©rifier les services

```bash
docker-compose ps
docker-compose logs app
docker-compose logs postgres
```

### 5.7 Arr√™ter tous les services

```bash
docker-compose down
```

Pour supprimer aussi les volumes (donn√©es) :

```bash
docker-compose down -v
```

## Commandes Docker utiles

### Gestion des conteneurs

```bash
# Lister les conteneurs actifs
docker ps

# Lister tous les conteneurs (actifs et arr√™t√©s)
docker ps -a

# Arr√™ter un conteneur
docker stop <container_id>

# D√©marrer un conteneur arr√™t√©
docker start <container_id>

# Red√©marrer un conteneur
docker restart <container_id>

# Supprimer un conteneur
docker rm <container_id>

# Supprimer tous les conteneurs arr√™t√©s
docker container prune
```

### Gestion des images

```bash
# Lister les images
docker images

# Supprimer une image
docker rmi <image_id>

# Supprimer les images non utilis√©es
docker image prune

# Supprimer toutes les images non utilis√©es
docker image prune -a
```

### Logs et d√©bogage

```bash
# Voir les logs d'un conteneur
docker logs <container_id>

# Suivre les logs en temps r√©el
docker logs -f <container_id>

# Ex√©cuter une commande dans un conteneur en cours
docker exec -it <container_id> sh

# Inspecter un conteneur
docker inspect <container_id>

# Voir les statistiques d'utilisation
docker stats
```

### Nettoyage complet

```bash
# Supprimer tous les conteneurs, images, r√©seaux et volumes non utilis√©s
docker system prune -a --volumes
```

:::danger Attention
Cette commande supprime TOUT ce qui n'est pas utilis√©. Utilisez avec pr√©caution !
:::

## Bonnes pratiques

1. **Utilisez des images officielles** : Pr√©f√©rez les images officielles depuis Docker Hub
2. **Images l√©g√®res** : Utilisez les variantes Alpine quand c'est possible
3. **Multi-stage builds** : Pour r√©duire la taille des images finales
4. **Ne pas ex√©cuter en root** : Cr√©ez un utilisateur dans vos Dockerfiles (production)
5. **Variables d'environnement** : Ne jamais hardcoder les secrets
6. **Sant√© des conteneurs** : Utilisez `HEALTHCHECK` dans vos Dockerfiles
7. **Limitez les ressources** : Utilisez `--memory` et `--cpus` en production
8. **Logs** : Configurez une rotation des logs pour √©viter de saturer le disque

## Pour aller plus loin

- **Docker Hub** : Explorez le registre d'images Docker
- **Multi-stage builds** : Optimisez vos images Docker
- **Docker networks** : Comprenez les diff√©rents types de r√©seaux
- **Docker volumes** : Ma√Ætrisez la persistance des donn√©es
- **Docker Swarm / Kubernetes** : Orchestration de conteneurs √† grande √©chelle
- **CI/CD avec Docker** : Int√©grez Docker dans vos pipelines

## Ressources

### T√©l√©chargements

<DownloadGroup title="Fichiers de la formation">
  <DownloadButton href="./files/app.zip" icon="üì¶">
    Application exemple (app.zip)
  </DownloadButton>
  <DownloadButton href="https://get.docker.com" variant="secondary" icon="üê≥">
    Script d'installation Docker
  </DownloadButton>
</DownloadGroup>

### Liens utiles

- [Documentation officielle Docker](https://docs.docker.com/)
- [Docker Hub](https://hub.docker.com/)
- [Best practices for writing Dockerfiles](https://docs.docker.com/develop/dev-best-practices/)
- [Docker Compose documentation](https://docs.docker.com/compose/)
- [Play with Docker](https://labs.play-with-docker.com/) - Environnement Docker en ligne gratuit
